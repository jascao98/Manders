var statesBorders = [
    {
        "type": "Feature",
        "id": "08",
        "properties": { 
            "name": "Colorado",
            "density": 49.33, 
            "population": 144723,
            "Democratic":61,
            "Republican":39,
            "White":20,
            "Hispanic":41,
            "AfricanAmerican":39
        },
        "geometry": {
            "type": "Polygon",
            "coordinates": [
                [
                    [-107.919731, 41.003906], [-105.728954, 40.998429], [-104.053011, 41.003906], [-102.053927, 41.003906], [-102.053927, 40.001626], [-102.042974, 36.994786], [-103.001438, 37.000263], [-104.337812, 36.994786], [-106.868158, 36.994786], [-107.421329, 37.000263], [-109.042503, 37.000263], [-109.042503, 38.166851], [-109.058934, 38.27639], [-109.053457, 39.125316], [-109.04798, 40.998429], [-107.919731, 41.003906]
                ]
            ]
        }
    },
    {
        "type":"Feature",
        "id":"12",
        "properties": {
            "name":"Florida",
            "density":353.4,
            "population": 4144723,
            "Democratic":21,
            "Republican":89,
            "White":10,
            "Hispanic":71,
            "AfricanAmerican":19
        },
        "geometry": {
            "type":"Polygon",
            "coordinates": [
                [
                    [-85.497137,30.997536],[-85.004212,31.003013],[-84.867289,30.712735],[-83.498053,30.647012],[-82.216449,30.570335],[-82.167157,30.356734],[-82.046664,30.362211],[-82.002849,30.564858],[-82.041187,30.751074],[-81.948079,30.827751],[-81.718048,30.745597],[-81.444201,30.707258],[-81.383954,30.27458],[-81.257985,29.787132],[-80.967707,29.14633],[-80.524075,28.461713],[-80.589798,28.41242],[-80.56789,28.094758],[-80.381674,27.738757],[-80.091397,27.021277],[-80.03115,26.796723],[-80.036627,26.566691],[-80.146166,25.739673],[-80.239274,25.723243],[-80.337859,25.465826],[-80.304997,25.383672],[-80.49669,25.197456],[-80.573367,25.241272],[-80.759583,25.164595],[-81.077246,25.120779],[-81.170354,25.224841],[-81.126538,25.378195],[-81.351093,25.821827],[-81.526355,25.903982],[-81.679709,25.843735],[-81.800202,26.090198],[-81.833064,26.292844],[-82.041187,26.517399],[-82.09048,26.665276],[-82.057618,26.878877],[-82.172634,26.917216],[-82.145249,26.791246],[-82.249311,26.758384],[-82.566974,27.300601],[-82.692943,27.437525],[-82.391711,27.837342],[-82.588881,27.815434],[-82.720328,27.689464],[-82.851774,27.886634],[-82.676512,28.434328],[-82.643651,28.888914],[-82.764143,28.998453],[-82.802482,29.14633],[-82.994175,29.179192],[-83.218729,29.420177],[-83.399469,29.518762],[-83.410422,29.66664],[-83.536392,29.721409],[-83.640454,29.885717],[-84.02384,30.104795],[-84.357933,30.055502],[-84.341502,29.902148],[-84.451041,29.929533],[-84.867289,29.743317],[-85.310921,29.699501],[-85.299967,29.80904],[-85.404029,29.940487],[-85.924338,30.236241],[-86.29677,30.362211],[-86.630863,30.395073],[-86.910187,30.373165],[-87.518128,30.280057],[-87.37025,30.427934],[-87.446927,30.510088],[-87.408589,30.674397],[-87.633143,30.86609],[-87.600282,30.997536],[-85.497137,30.997536]
                ]
            ]
        }
    },
    {
        "type":"Feature",
        "id":"24",
        "properties": {
            "name":"Maryland",
            "density":596.3,
            "population": 999,
            "Democratic":20,
            "Republican":80,
            "White":40,
            "Hispanic":41,
            "AfricanAmerican":19
        },
        "geometry": {
            "type":"MultiPolygon",
            "coordinates": [
                [
                    [[-75.994645,37.95325],[-76.016553,37.95325],[-76.043938,37.95325],[-75.994645,37.95325]]
                ], 
                [
                    [[-79.477979,39.722302],[-75.786521,39.722302],[-75.693413,38.462606],[-75.047134,38.451652],[-75.244304,38.029928],[-75.397659,38.013497],[-75.671506,37.95325],[-75.885106,37.909435],[-75.879629,38.073743],[-75.961783,38.139466],[-75.846768,38.210667],[-76.000122,38.374975],[-76.049415,38.303775],[-76.257538,38.320205],[-76.328738,38.500944],[-76.263015,38.500944],[-76.257538,38.736453],[-76.191815,38.829561],[-76.279446,39.147223],[-76.169907,39.333439],[-76.000122,39.366301],[-75.972737,39.557994],[-76.098707,39.536086],[-76.104184,39.437501],[-76.367077,39.311532],[-76.443754,39.196516],[-76.460185,38.906238],[-76.55877,38.769315],[-76.514954,38.539283],[-76.383508,38.380452],[-76.399939,38.259959],[-76.317785,38.139466],[-76.3616,38.057312],[-76.591632,38.216144],[-76.920248,38.292821],[-77.018833,38.446175],[-77.205049,38.358544],[-77.276249,38.479037],[-77.128372,38.632391],[-77.040741,38.791222],[-76.909294,38.895284],[-77.035264,38.993869],[-77.117418,38.933623],[-77.248864,39.026731],[-77.456988,39.076023],[-77.456988,39.223901],[-77.566527,39.306055],[-77.719881,39.322485],[-77.834897,39.601809],[-78.004682,39.601809],[-78.174467,39.694917],[-78.267575,39.61824],[-78.431884,39.623717],[-78.470222,39.514178],[-78.765977,39.585379],[-78.963147,39.437501],[-79.094593,39.470363],[-79.291763,39.300578],[-79.488933,39.20747],[-79.477979,39.722302]]
                ]
            ]
        }
    }
]


var coloradoDistricts=[{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
            "name": "District 1",
            "density": 49.33,
            "population": 1111,
            "Democratic":11,
            "Republican":88,
            "White":10,
            "Hispanic":21,
            "AfricanAmerican":69
             },

      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -109.017333984375,
              37.02886944696474
            ],
            [
              -106.732177734375,
              37.02886944696474
            ],
            [
              -106.732177734375,
              40.88029480552824
            ],
            [
              -109.017333984375,
              40.88029480552824
            ],
            [
              -109.017333984375,
              37.02886944696474
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
            "name": "District 2",
            "density": 49.33,
            "population": 4123,
            "Democratic":15,
            "Republican":85,
            "White":90,
            "Hispanic":8,
            "AfricanAmerican":12
             },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -106.68823242187499,
              39.14710270770074
            ],
            [
              -102.12890625,
              39.14710270770074
            ],
            [
              -102.12890625,
              40.88029480552824
            ],
            [
              -106.68823242187499,
              40.88029480552824
            ],
            [
              -106.68823242187499,
              39.14710270770074
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
            "name": "District 3",
            "density": 49.33,
            "population": 74723,
            "Democratic":35,
            "Republican":65,
            "White":60,
            "Hispanic":12,
            "AfricanAmerican":28
             },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -106.666259765625,
              37.07271048132943
            ],
            [
              -102.12890625,
              37.07271048132943
            ],
            [
              -102.12890625,
              39.0533181067413
            ],
            [
              -106.666259765625,
              39.0533181067413
            ],
            [
              -106.666259765625,
              37.07271048132943
            ]
          ]
        ]
      }
    }
  ]
}]

var coloradoPrecincts=[{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
            "name": "Precinct 1",
            "density": 49.33,
            "population": 1111,
            "Democratic":11,
            "Republican":89,
            "White":22,
            "Hispanic":50,
            "AfricanAmerican":33
          },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -106.622314453125,
              40.10328591293439
            ],
            [
              -106.2158203125,
              40.10328591293439
            ],
            [
              -106.2158203125,
              40.95501133048621
            ],
            [
              -106.622314453125,
              40.95501133048621
            ],
            [
              -106.622314453125,
              40.10328591293439
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
     "properties": {
            "name": "Precinct 2",
            "density": 49.33,
            "population": 2,
            "Democratic":50,
            "Republican":50,
            "White":50,
            "Hispanic":20,
            "AfricanAmerican":30
          },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -106.07299804687499,
              39.36827914916014
            ],
            [
              -105.29296874999999,
              39.36827914916014
            ],
            [
              -105.29296874999999,
              40.88860081193033
            ],
            [
              -106.07299804687499,
              40.88860081193033
            ],
            [
              -106.07299804687499,
              39.36827914916014
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
            "name": "Precinct 3",
            "density": 49.33,
            "population": 1,
            "Democratic":61,
            "Republican":39,
            "White":40,
            "Hispanic":41,
            "AfricanAmerican":19},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -105.18310546875,
              40.3130432088809
            ],
            [
              -102.249755859375,
              40.3130432088809
            ],
            [
              -102.249755859375,
              40.84706035607122
            ],
            [
              -105.18310546875,
              40.84706035607122
            ],
            [
              -105.18310546875,
              40.3130432088809
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
            "name": "Precinct 4",
            "density": 49.33,
            "population": 20,
            "Democratic":41,
            "Republican":59,
            "White":70,
            "Hispanic":30,
            "AfricanAmerican":0
          },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -105.10620117187499,
              39.155622393423215
            ],
            [
              -102.23876953125,
              39.155622393423215
            ],
            [
              -102.23876953125,
              40.136890695345905
            ],
            [
              -105.10620117187499,
              40.136890695345905
            ],
            [
              -105.10620117187499,
              39.155622393423215
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
            "name": "Precinct 5",
            "density": 49.33,
            "population": 123,
            "Democratic":90,
            "Republican":10,
            "White":10,
            "Hispanic":20,
            "AfricanAmerican":70},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -106.5234375,
              39.12153746241925
            ],
            [
              -106.12792968749999,
              39.12153746241925
            ],
            [
              -106.12792968749999,
              39.96870074491696
            ],
            [
              -106.5234375,
              39.96870074491696
            ],
            [
              -106.5234375,
              39.12153746241925
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
            "name": "Precinct 6",
            "density": 49.33,
            "population": 223,
            "Democratic":81,
            "Republican":19,
            "White":60,
            "Hispanic":11,
            "AfricanAmerican":33},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -105.985107421875,
              39.07037913108751
            ],
            [
              -105.216064453125,
              39.07037913108751
            ],
            [
              -105.216064453125,
              39.21523130910491
            ],
            [
              -105.985107421875,
              39.21523130910491
            ],
            [
              -105.985107421875,
              39.07037913108751
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
            "name": "Precinct 7",
            "density": 49.33,
            "population": 223,
            "Democratic":81,
            "Republican":19,
            "White":60,
            "Hispanic":11,
            "AfricanAmerican":33},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -105.16113281249999,
              38.50948995925553
            ],
            [
              -102.1893310546875,
              38.50948995925553
            ],
            [
              -102.1893310546875,
              39.05758374935667
            ],
            [
              -105.16113281249999,
              39.05758374935667
            ],
            [
              -105.16113281249999,
              38.50948995925553
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
            "name": "Precinct 8",
            "density": 49.33,
            "population": 223,
            "Democratic":81,
            "Republican":19,
            "White":60,
            "Hispanic":11,
            "AfricanAmerican":33},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -107.16064453125,
              38.792626957868904
            ],
            [
              -106.7156982421875,
              38.792626957868904
            ],
            [
              -106.7156982421875,
              40.896905775860006
            ],
            [
              -107.16064453125,
              40.896905775860006
            ],
            [
              -107.16064453125,
              38.792626957868904
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
            "name": "Precinct 9",
            "density": 49.33,
            "population": 223,
            "Democratic":81,
            "Republican":19,
            "White":60,
            "Hispanic":11,
            "AfricanAmerican":33},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -108.12744140625,
              38.09133660751176
            ],
            [
              -107.22656249999999,
              38.09133660751176
            ],
            [
              -107.22656249999999,
              40.88860081193033
            ],
            [
              -108.12744140625,
              40.88860081193033
            ],
            [
              -108.12744140625,
              38.09133660751176
            ]
          ]
        ]
      }
    }
  ]
}]

var mode = 'default'

var usaCoords = [39.51073, -96.4247]

// Ghost mode variables
var ghost_points = []

// Current Error Circles
var err_circ = []

var mymap = L.map('mapid',
    {
    //set minZoom and maxZoom to stop map from zooming out furthur than the U.S
    minZoom:5,
    maxZoom: 15,
    //if map is dragged outside of United states, then it moves view back to U.S
    maxBounds:[[20.396308, -135.848974], [49.384358, -55.885444]]
    }).setView(usaCoords, 5);

L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    id: 'mapbox/streets-v11',
    accessToken: 'pk.eyJ1IjoiZGFuZzk4IiwiYSI6ImNrNmlsbGZqNTAyYzgzZHFtcjczMmI2Z3EifQ.N6aBfLfiwLfyTn_Iz0TvIw'
}).addTo(mymap);



mymap.on('click', function(e) {
  if(mode == 'ghost')
  {
    var lat = e.latlng.lat
    var lng = e.latlng.lng
    ghost_points.push([lng, lat])
  }
  else if(mode == 'comment')
  {
    var lat = e.latlng.lat
    var lng = e.latlng.lng
    var input = window.prompt("enter your comment: ")
    var customMarker = L.Marker.extend({
      options: 
      {
        comment: 'dannyboi is snek leader'
      }
    })
    var marker = new customMarker([lat, lng], {comment : input})
    marker.on('mouseover', function(e)
    {
      commentInfo.update(marker)
    })
    marker.addTo(mymap)
  }
})
//L.geoJson(statesBorders).addTo(mymap)
//==================Functions========================================================================================================================


//add in information on hover
var info = L.control();

info.onAdd = function (mymap) {
    this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    this.update();
    return this._div;
};


// method used to update the control based on feature properties passed
//to add in more data, add in the variables for each state object in stateBorders
info.update = function (props) {
    this._div.innerHTML = '<h4>U.S State Data</h4>' +  (props ?
        '<b>' + props.name + '</b><br />' + 'Democratic: '+ props.Democratic+'%'+
        '</b><br>Republican: '+props.Republican+'%'+'</b><br />White: '+props.White+'%'+
        '</b><br />Hispanic: '+props.Hispanic+'%'+'</b><br />African American: '
        +props.AfricanAmerican+'%'+'</b><br />Population:'+props.population
        : 'Hover for more detail');
   
    //  '<b>' + props.name + '</b><br />' + props.density + ' people / mi<sup>2</sup>'
    //  : 'Hover states for more details');
};

info.addTo(mymap);

var commentInfo = L.control({position: 'bottomleft'})

commentInfo.onAdd = function (mymap) {
  this._div = L.DomUtil.create('div', 'info')
  this.update();
  return this._div
}

commentInfo.update = function(props) {
  this._div.innerHTML = '<h4> Comments </h4>' + (props ? props.options.comment : '')
}

commentInfo.addTo(mymap)


//mousing over a state and highlighting it
function highlightFeature(e) {
    var layer = e.target;

    layer.setStyle({
        weight: 4,
        color: '#1a0aff',
        dashArray: '',
        fillOpacity: 0.2
    });

    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
    }
    info.update(layer.feature.properties);
}

//variable definition for adding in geojson 
var statesGeojson;
var precinctGeojson;
var districtGeojson;
var ghostPrecinct;


//if mouse leaves state, stop the highlight
function resetHighlight(e) {
  if (mymap.hasLayer(statesGeojson)) {
     statesGeojson.resetStyle(e.target);
     info.update();
  }
  else if (mymap.hasLayer(precinctGeojson)) {
     precinctGeojson.resetStyle(e.target);
     info.update();
  }
  else if (mymap.hasLayer(districtGeojson)) {
     districtGeojson.resetStyle(e.target);
     info.update();
  }
   
}

/* Handles Clicks onS States */
function onClickHandler(e) {
    zoomToFeature(e);
    stateChangeHandler(e.target.feature.properties.name);
}


function zoomToFeature(e) {
        mymap.fitBounds(e.target.getBounds());
}

//can add more interactions for listeners here
//add the listeners to the state layer 
function onEachFeature(feature, layer) {
    layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
        click: onClickHandler
    });
}

//add into map
statesGeojson = L.geoJson(statesBorders,{
    onEachFeature: onEachFeature
}).addTo(mymap);


function addCircle(lat, long, radius) {
  var circ = L.circle([lat, long], radius, {color: "red", fillColor: "red"});
  err_circ.push(circ);
  circ.addTo(mymap);
}

function removeCircles() {
  for (circ in err_circ) {
    mymap.removeLayer(err_circ[circ]);
  }
}

function panMap(lat, long, zoom) {
  mymap.setView([lat, long], zoom);
}


//need to seperate state borders so zoom in only shows fo specific district or state
//for display district, precinct or state based on zoom level
mymap.on('zoomend', function(e) {
var zoomlevel = mymap.getZoom();
    
    //level 7 zoom is district level
    if (zoomlevel==7){
      //disable all geojson
      if (mymap.hasLayer(statesGeojson)) {
        //remove state geojson and add district
        mymap.removeLayer(statesGeojson);
        console.log("adasd");
      }
      else {
        console.log("1no states layer active");
      }
      if (mymap.hasLayer(precinctGeojson)) {
        //remove precinct geojson and add district
        mymap.removeLayer(precinctGeojson);
      }
      else {
        console.log("2no precinct layer active");
      }
      
      //add in district geojson only if its not present
      if(!mymap.hasLayer(districtGeojson)){
        districtGeojson=L.geoJson(coloradoDistricts,{
        onEachFeature: onEachFeature
        }).addTo(mymap);  
      }  
    }

    //level 8 zoom is for precincts
    else if (zoomlevel>=8){
      //disable all geojson
      if (mymap.hasLayer(statesGeojson)) {
        //remove state geojson and add district
        mymap.removeLayer(statesGeojson);
      }
      else {
        console.log("3no states layer active");
      }
      if (mymap.hasLayer(districtGeojson)) {
        //remove precinct geojson and add district
        mymap.removeLayer(districtGeojson);
      }
      else {
        console.log("4no states layer active");
      }

      //add in precinct geojson if its not present already
      if(!mymap.hasLayer(precinctGeojson)){
        precinctGeojson=L.geoJson(coloradoPrecincts,{
        onEachFeature: onEachFeature
        }).addTo(mymap);
      } 

    }

    //else show only states level geojson
    else {
      //disable all geojson
      if (mymap.hasLayer(precinctGeojson)) {
        //remove state geojson and add district
        mymap.removeLayer(precinctGeojson);
      }
      else {
        console.log("5no states layer active");
      }
      if (mymap.hasLayer(districtGeojson)) {
        //remove precinct geojson and add district
        mymap.removeLayer(districtGeojson);
      }
      else {
        console.log("6no states layer active");
      }

      //add in state geojson if itsn ot present
      if(!mymap.hasLayer(statesGeojson)){
        statesGeojson=L.geoJson(statesBorders,{
        onEachFeature: onEachFeature
        }).addTo(mymap); 
      }
    }

console.log("Current Zoom Level =" + zoomlevel)
});


//when user clicks okay for combing precincts, get precinct names and merge
//this function assumes the 2 precincts are valid 
function handle_CombinePrecinct_Click(){
  var selected1 = document.getElementById("precinct-select1");
  var precinct1 = selected1.options[selected1.selectedIndex].value;
  var selected2 = document.getElementById("precinct-select2");
  var precinct2 = selected2.options[selected2.selectedIndex].value;
  console.log(precinct1);
  console.log(precinct2);
  //bruh how to merge the 2 precincts
}







